import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

const supabase = createClient(supabaseUrl, supabaseAnonKey);

interface DetailRow {
  school_id: number;
  category_id: number;
  documents_required: string;
  course_details: string;
  lecture_details: string;
  fees: string;
}

const csvData = `school_id,category_id,documents_required,course_details,lecture_details,fees
4,1,"[{""type"":""Students with foreign licenses"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Original home country license"",""Minimum age 17 years""],""notes"":""""},{""type"":""Emirati students"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Minimum age 17 years""],""notes"":""""},{""type"":""GCC license holders"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Original GCC license""],""notes"":""""},{""type"":""Visa holders from other Emirates"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Trade License copy of both Dubai and visa-owned Emirates (must have the same trade name)""],""notes"":""""}]","[{""type"":""Motorcycle Training Course"",""title"":""Course Details"",""details"":[""Beginners: 20 mandatory hours"",""License holders (2+ years): 10 hours"",""Failed students: 4 hours retraining before retest"",""GCC license holders: direct knowledge and final test (4-hour training if failed)"",""8 theory lectures, signal test, internal and road tests"",""Assessment and final tests included""],""notes"":""Recognized license holders from 33 countries can transfer directly at RTA offices. People with UAE licenses from other Emirates must transfer their file before registering. All fines must be cleared before opening a new file.""}]","[{""type"":""E-Learning Lectures"",""title"":""Mandatory Theory Training"",""details"":[""All students must complete mandatory theory training"",""E-Learning facilities available for motorcycle course"",""Bring Registration Card, RTA Training Book, and Learning Permit to each lecture"",""Complete E-Learning or lectures before booking RTA Theory Test"",""If absent, provide 48 hours' notice""],""notes"":""""}]","{""timings"":{""Regular Training"":""8:30am–2:30pm & 3:30pm–5:30pm"",""Sunday Training"":""8:00am–2:00pm & 3:00pm–5:00pm"",""Night Training"":""8:00pm–11:00pm""},""course_fees"":[{""category"":""Motorcycle"",""min_age"":17,""internal_training"":""10 hours"",""road_training"":""20 hours"",""regular_course_fees"":{""hourly"":120,""total"":4360},""sunday_night_shift_fees"":{""hourly"":150,""total"":4760},""notes"":""All prices in AED, excluding VAT""}],""other_fees"":[{""type"":""Opening File (All Categories)"",""RTA"":200,""DDC"":540},{""type"":""Learning Permit (Light Vehicle)"",""RTA"":100,""DDC"":null},{""type"":""Knowledge Handbook"",""RTA"":50,""DDC"":null},{""type"":""Knowledge Dirham"",""RTA"":10,""DDC"":null},{""type"":""Innovation Dirham"",""RTA"":10,""DDC"":null},{""type"":""Internal Test (Yard)"",""RTA"":220,""DDC"":70},{""type"":""Internal Test (Road)"",""RTA"":220,""DDC"":70},{""type"":""Knowledge Test"",""RTA"":220,""DDC"":70},{""type"":""Final Test"",""RTA"":220,""DDC"":70},{""type"":""License Issuance (>1 Year)"",""RTA"":320,""DDC"":100},{""type"":""License Issuance (1 Year)"",""RTA"":120,""DDC"":100},{""type"":""Initial Driving Assessment Test"",""RTA"":null,""DDC"":100}]}"
4,2,"[{""type"":""Beginners"",""documents"":[""Original Emirates ID"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Minimum age 17.6 years""],""notes"":""""},{""type"":""Students with foreign licenses"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Original home country license"",""Minimum age 17.6 years"",""If sponsor is husband/father, passport copy required""],""notes"":""""},{""type"":""Emirati students"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Student ID card"",""Minimum age 17.6 years""],""notes"":""""},{""type"":""GCC license holders"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Original GCC license""],""notes"":""""},{""type"":""Company-sponsored applicants (other Emirates visa)"",""documents"":[""Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Trade license copies for Dubai and visa-owned emirates (same name)"",""NOC letter from Dubai branch confirming employment"",""Driving license (if any)""],""notes"":""""},{""type"":""Dependent visa holders (other Emirates visa)"",""documents"":[""Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Tenancy contract"",""Driving license (if any)""],""notes"":""""}]","[{""type"":""Light Motor Vehicle Training Course"",""title"":""Course Details"",""details"":[""Beginners: 20 mandatory hours"",""License holders (2–5 years): 15 hours"",""License holders (5+ years): 10 hours"",""All LMV students (10/15/20 hours) must complete 8 theory lessons (available online)"",""10/15-hour students must pass an Evaluation Test to confirm skill level; failure results in beginner classification"",""Students failing the final RTA test must complete 4-hour retraining"",""Transfer students with >30 days gap require a re-evaluation test"",""Automatic and Manual transmission available; Automatic license holders cannot drive manual"",""Mandatory: 1-hour night training (optional for females)"",""Highway & independent training: 10/15-hour students require 1-hour each, 20-hour students require 2-hours each"",""Highway classes must be completed before final RTA test""],""notes"":""Manual Driving Lessons Dubai include clutch control and off-road basics. Comprehensive LMV course with evaluation and RTA final test.""}]","[{""type"":""E-Learning Lectures"",""title"":""Mandatory Theory Training"",""details"":[""8 mandatory lectures for LMV students"",""Lecture 1: Attitude and Responsibilities of the Driver"",""Lecture 2: Knowledge of Traffic Rules and Regulations"",""Lecture 3: Characteristics of Road Users"",""Lecture 4: Driver Condition"",""Lecture 5: The Driving Environment"",""Lecture 6: Driving on Freeways, Traffic Violations, and Route Planning"",""Lecture 7: Hazard perception training"",""Lecture 8: Traffic Accidents, Case Studies, and What to do in an Accident"",""All lectures can be attended online or in person via E-Learning Platform""],""notes"":""Complete all 8 lectures before booking RTA Theory Test. 48-hour absence notice required. Ensure payments are up to date.""},{""type"":""Comprehensive LMV Curriculum"",""title"":""5-Stage Practical Curriculum"",""details"":[""Stage 1: Off-road (vehicle checks, posture, mirrors, safety precautions, moving off and stopping safely)"",""Stage 2: Light to medium traffic (rules of priority, junctions, obstructions, pedestrian crossings, vulnerable road users)"",""Stage 3: Medium to heavy traffic (planning, anticipation, speed management, overtaking, roundabouts, night driving)"",""Stage 4: Off-road manoeuvres (angle parking, garage parking, parallel parking, emergency stops, incline start)""],""notes"":""""}]","{""timings"":{""Regular Training"":""8:30am–2:30pm & 3:30pm–5:30pm"",""Sunday Training"":""8:00am–2:00pm & 3:00pm–5:00pm"",""Night Training"":""8:00pm–11:00pm""},""course_fees"":[{""category"":""Light Vehicle Manual and Automatic"",""min_age"":18,""road_training"":""20 / 15 / 10 hours"",""regular_course_fees"":{""hourly"":120,""total"":[4760,4260,3660]},""sunday_night_shift_fees"":{""hourly"":150,""total"":[5360,4710,3960]},""notes"":""All prices in AED, excluding VAT""},{""category"":""Royal VIP"",""min_age"":18,""road_training"":""20 / 15 / 10 hours"",""regular_course_fees"":{""total"":[25000,21000,17000]},""sunday_night_shift_fees"":{""total"":[25000,21000,17000]},""notes"":""Exclusive VIP packages with dedicated instructor and premium scheduling""}],""other_fees"":[{""type"":""Opening File (All Categories)"",""RTA"":200,""DDC"":540},{""type"":""Learning Permit (Light Vehicle)"",""RTA"":100,""DDC"":null},{""type"":""Knowledge Handbook"",""RTA"":50,""DDC"":null},{""type"":""Knowledge Dirham"",""RTA"":10,""DDC"":null},{""type"":""Innovation Dirham"",""RTA"":10,""DDC"":null},{""type"":""Internal Test (Motorcycle/Heavy/Light Vehicle)"",""RTA"":220,""DDC"":70},{""type"":""Knowledge Test"",""RTA"":220,""DDC"":70},{""type"":""Final Test"",""RTA"":220,""DDC"":70},{""type"":""License Issuance (>1 Year)"",""RTA"":320,""DDC"":100},{""type"":""License Issuance (1 Year)"",""RTA"":120,""DDC"":100},{""type"":""Evaluation Test (Light Vehicle)"",""RTA"":null,""DDC"":100},{""type"":""Initial Driving Assessment Test"",""RTA"":null,""DDC"":100}]}"
4,3,"[{""type"":""Beginners"",""documents"":[""Original Emirates ID"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Minimum age 20 years""],""notes"":""""},{""type"":""Emirati students"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Minimum age 20 years""],""notes"":""""},{""type"":""GCC license holders"",""documents"":[""Emirates ID card or report of ID transaction"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Original GCC license"",""Minimum age 20 years""],""notes"":""""},{""type"":""Visa holders from other Emirates"",""documents"":[""Passport copies with valid Dubai residence visa"",""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Trade License copies for Dubai and visa-owned Emirates (same trade name)"",""NOC letter from the Dubai branch confirming employment"",""Minimum age 20 years""],""notes"":""""}]","[{""type"":""Heavy Truck Training Course"",""title"":""Course Details"",""details"":[""Minimum registration age: 20 years"",""No LMV driving license required for HMV registration"",""Mandatory 20 hours of practical training + 8 theory lectures"",""Students without LMV license must complete basic LMV control training (Curriculum subjects 1.07–1.12)"",""Students failing RTA final test at another institute: 4-hour minimum retraining"",""Transfer students (>60 days gap) must take an evaluation test"",""All training in manual vehicles (no automatic option)"",""Tests include: Yard Test (internal), RTA Yard Test, Articulated truck training, RTA Final Road Test"",""Minimum 1-hour night training required""],""notes"":""Medical requirements: Heavy bus drivers must undergo medical fitness exam at RTA-approved centers and obtain commercial driving permit (AED 110) after license issuance.""}]","[{""type"":""E-Learning & Classroom Lectures"",""title"":""Mandatory Theory Training"",""details"":[""8 core lectures for HMV students (E-Learning or classroom)"",""Lecture 1: Attitude and Responsibilities of the Driver"",""Lecture 2: Knowledge of Traffic Rules and Regulations"",""Lecture 3: Characteristics of Road Users"",""Lecture 4: Driver Condition"",""Lecture 5: The Driving Environment"",""Lecture 6: Driving on Freeways, Traffic Violations & Route Planning"",""Lecture 7: Hazard Perception Training"",""Lecture 8: Traffic Accidents, Case Studies & What to do in an Accident"",""Lecture 9: Articulated Vehicles (Truck only)""],""notes"":""Bring Registration Card, RTA Training Book, and Learning Permit to each lecture. 48-hour absence notice required. Ensure payments are up to date.""}]","{""timings"":{""Regular Training"":""8:30am–2:30pm & 3:30pm–5:30pm"",""Sunday Training"":""7:00am–12:00pm & 2:00pm–5:00pm"",""Night Training"":""8:00pm–11:00pm""},""course_fees"":[{""category"":""Heavy Truck"",""min_age"":20,""road_training"":""20 hours"",""total_hours"":28,""regular_course_fees"":{""hourly"":160,""total"":4810},""sunday_night_shift_fees"":{""hourly"":220,""total"":5950},""notes"":""All prices in AED, excluding VAT""}],""other_fees"":[{""type"":""Opening File (All Categories)"",""RTA"":200,""DDC"":540},{""type"":""Learning Permit (Heavy Vehicle)"",""RTA"":200,""DDC"":null},{""type"":""Knowledge Handbook"",""RTA"":50,""DDC"":null},{""type"":""Knowledge Dirham"",""RTA"":10,""DDC"":null},{""type"":""Innovation Dirham"",""RTA"":10,""DDC"":null},{""type"":""Internal Test Fees"",""RTA"":220,""DDC"":70},{""type"":""Knowledge Test (All Categories)"",""RTA"":220,""DDC"":70},{""type"":""Final Test (All Categories)"",""RTA"":220,""DDC"":70},{""type"":""License Issuance (>1 Year)"",""RTA"":320,""DDC"":100},{""type"":""License Issuance (1 Year)"",""RTA"":120,""DDC"":100},{""type"":""Initial Driving Assessment Test"",""RTA"":null,""DDC"":100}]}"
4,4,"[{""type"":""Expatriates (Dubai visa holders)"",""documents"":[""Original Emirates ID"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Minimum age 21 years""],""notes"":""""},{""type"":""Emirati students"",""documents"":[""Original Emirates ID card"",""Two passport-size photographs"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Minimum age 21 years""],""notes"":""""},{""type"":""Visa holders from other Emirates"",""documents"":[""Passport copies with valid Dubai residence visa"",""Original Emirates ID card"",""Trade License copies for Dubai and visa-owned Emirates (same name)"",""NOC letter from the Dubai branch confirming employment"",""Minimum age 20 years"",""If sponsor is father, a copy of sponsor's passport is required""],""notes"":""""}]","[{""type"":""Light Bus Training Course"",""title"":""Course Details"",""details"":[""Minimum registration age: 21 years"",""Failed RTA road test at another institute → minimum of 4 hours retraining required"",""Mandatory 20 hours of practical training + 8 theory lectures"",""Tests required: Knowledge Test, RTA Yard Test, Internal Assessment, and RTA Final Road Test"",""Minimum 1-hour night training required"",""Medical fitness exam required at RTA-approved medical center"",""After passing all tests, obtain commercial driving permit (AED 110)""],""notes"":""Designed for drivers aiming to obtain Light Bus commercial license under RTA guidelines.""}]","[{""type"":""Theory Lectures"",""title"":""Not specified"",""details"":[],""notes"":""No lecture data provided in source; placeholder entry maintained for schema consistency.""}]","{""timings"":{""Regular Training"":""8:30am–2:30pm & 3:30pm–5:30pm"",""Sunday Training"":""7:00am–12:00pm & 2:00pm–5:00pm"",""Night Training"":""8:00pm–11:00pm""},""course_fees"":[{""category"":""Light Bus"",""min_age"":20,""road_training"":""20 hours"",""total_hours"":28,""regular_course_fees"":{""hourly"":150,""total"":4490},""sunday_night_shift_fees"":{""hourly"":180,""total"":5090},""notes"":""All prices in AED, excluding VAT""}],""other_fees"":[{""type"":""Opening File (All Categories)"",""RTA"":200,""DDC"":540},{""type"":""Learning Permit (Light Vehicle)"",""RTA"":100,""DDC"":null},{""type"":""Learning Permit (Heavy Vehicle)"",""RTA"":200,""DDC"":20},{""type"":""Knowledge Handbook"",""RTA"":50,""DDC"":null},{""type"":""Knowledge Dirham"",""RTA"":10,""DDC"":null},{""type"":""Innovation Dirham"",""RTA"":10,""DDC"":null},{""type"":""Internal Test Fees"",""RTA"":220,""DDC"":70},{""type"":""Knowledge Test (All Categories)"",""RTA"":220,""DDC"":70},{""type"":""Final Test (All Categories)"",""RTA"":220,""DDC"":70},{""type"":""License Issuance (>1 Year)"",""RTA"":320,""DDC"":100},{""type"":""License Issuance (1 Year)"",""RTA"":120,""DDC"":100},{""type"":""Initial Driving Assessment Test"",""RTA"":null,""DDC"":100}]}"
4,5,"[{""type"":""Beginners"",""documents"":[""Original Emirates ID"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Minimum age 21 years""],""notes"":""""},{""type"":""Emirati students"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Minimum age 21 years""],""notes"":""""},{""type"":""GCC license holders"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Minimum age 21 years"",""If sponsor is father, a copy of sponsor's passport is required""],""notes"":""""},{""type"":""Visa holders from other Emirates"",""documents"":[""Original Emirates ID card"",""Trade License copies of both Dubai and visa-owned Emirates (same name)"",""NOC letter from Dubai branch confirming employment"",""Minimum age 20 years"",""If sponsor is father, a copy of sponsor's passport is required""],""notes"":""""}]","[{""type"":""Heavy Bus Training Course"",""title"":""Course Details"",""details"":[""Minimum registration age: 21 years"",""No LMV license required for Heavy Bus registration"",""Mandatory 20 hours of practical training + 8 theory lectures"",""Students without LMV license must complete basic LMV control training (Curriculum 1.07–1.12)"",""Students failing RTA final test at another institute: 4-hour minimum retraining"",""Required Documents: Emirates ID, Eye test report (at DDC Head Office / Al Qusais / Al Khail / DIP 2), Original license (if any)"",""Training requirements include: Practical training, Initial Driving Assessment (internal), RTA Yard Test, and Final RTA Road Test"",""Minimum 1-hour night training required""],""notes"":""Training conducted only in manual transmission buses. Designed to meet RTA Heavy Bus standards.""}]","[{""type"":""Heavy Bus Theory Lectures"",""title"":""Mandatory Theory Training"",""details"":[""Lecture 1: Attitude and Responsibilities of the Driver"",""Lecture 2: Knowledge of Traffic Rules and Regulations (specific to Heavy Bus)"",""Lecture 3: Characteristics of Road Users (additional info for Heavy Bus drivers)"",""Lecture 4: Driver Condition"",""Lecture 5: The Driving Environment"",""Lecture 6: Driving on Freeways, Traffic Violations & Route Planning"",""Lecture 7: Hazard Perception Training"",""Lecture 8: Traffic Accidents, Case Studies & What to Do in an Accident""],""notes"":""All lectures can be attended via E-Learning or classroom mode. Attendance required before RTA Theory Test booking.""}]","{""timings"":{},""course_fees"":[],""other_fees"":[],""notes"":""Fees information not available in the provided data; section intentionally left empty.""}"
4,6,"[{""type"":""Expatriates (Dubai visa holders)"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Minimum age 20 years""],""notes"":""Registration open for Dubai visa holders only. Refer to 'How to register for residence visa holders from other emirates' for more info.""},{""type"":""Emirati students"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Minimum age 20 years""],""notes"":""""},{""type"":""Visa holders from other Emirates"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Trade License copy of both branches (visa-holding branch and Dubai branch, trade name must match)"",""NOC letter from Dubai branch confirming employment""],""notes"":""""}]","[{""type"":""Light Forklift Training Course"",""title"":""Course Details"",""details"":[""Minimum registration age: 20 years"",""Students failing final RTA road test at another institute: minimum 4 hours retraining"",""Transfer students with more than 60 days gap must take an evaluation test"",""Mandatory 20 hours of practical training + 4 theory lectures"",""Tests include: Knowledge Test, Initial Driving Assessment (internal), and RTA Final Test""],""notes"":""See registration requirements and test details. Training follows RTA Light Forklift guidelines.""}]","[{""type"":""Theory Lectures"",""title"":""Light Forklift Theory"",""details"":[],""notes"":""No detailed lecture topics provided; placeholder maintained for schema consistency.""}]","{""timings"":{""Regular Training"":""8:30am–2:30pm & 3:30pm–5:30pm"",""Sunday Training"":""7:00am–12:00pm & 2:00pm–5:00pm"",""Night Training"":""8:00pm–11:00pm""},""course_fees"":[{""category"":""Light Forklift"",""min_age"":20,""road_training"":""20 hours"",""total_hours"":24,""regular_course_fees"":{""hourly"":120,""total"":3650},""sunday_night_shift_fees"":{""hourly"":150,""total"":4250},""notes"":""All prices in AED, excluding VAT""}],""other_fees"":[{""type"":""Opening File (All Categories)"",""RTA"":200,""DDC"":540},{""type"":""Learning Permit (Light Vehicle)"",""RTA"":100,""DDC"":null},{""type"":""Learning Permit (Heavy Vehicle)"",""RTA"":200,""DDC"":null},{""type"":""Knowledge Handbook"",""RTA"":50,""DDC"":null},{""type"":""Knowledge Dirham"",""RTA"":10,""DDC"":null},{""type"":""Innovation Dirham"",""RTA"":10,""DDC"":null},{""type"":""Internal Test (Motorcycle/Heavy/Light Vehicle)"",""RTA"":220,""DDC"":70},{""type"":""Knowledge Test (All Categories)"",""RTA"":220,""DDC"":70},{""type"":""Final Test (All Categories)"",""RTA"":220,""DDC"":70},{""type"":""License Issuance (>1 Year)"",""RTA"":320,""DDC"":100},{""type"":""License Issuance (1 Year)"",""RTA"":120,""DDC"":100},{""type"":""Initial Driving Assessment Test (All Categories)"",""RTA"":null,""DDC"":100}]}"
4,7,"[{""type"":""Expatriates (Dubai visa holders)"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Minimum age 20 years""],""notes"":""Registration for Dubai visa holders only. For residence visa holders from other emirates, follow RTA registration process.""},{""type"":""Emirati students"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Minimum age 20 years""],""notes"":""""},{""type"":""Visa holders from other Emirates"",""documents"":[""Original Emirates ID card"",""Eye test report (can be completed at DDC Head Office / Al Qusais / Al Khail / DIP 2)"",""Trade License copy of both branches (Visa holding branch and Dubai branch; trade names must match)"",""NOC letter from the Dubai branch confirming employment""],""notes"":""""}]","[{""type"":""Heavy Forklift Training Course"",""title"":""Course Details"",""details"":[""Minimum registration age: 20 years"",""Students failing the final RTA road test at another institute: minimum of 4 hours retraining required"",""Transfer students with a gap of over 60 days must take an evaluation test"",""Mandatory 20 hours of practical training + 4 theory lectures"",""Tests include: Knowledge Test, Initial Driving Assessment Test (internal), and RTA Final Test""],""notes"":""Follow RTA heavy forklift training standards. Refer to registration document requirements for complete eligibility.""}]","[{""type"":""Theory Lectures"",""title"":""Heavy Forklift Training Theory"",""details"":[],""notes"":""No detailed lecture list provided in source; placeholder maintained for schema consistency.""}]","{""timings"":{""Regular Training"":""8:30am–2:30pm & 3:30pm–5:30pm"",""Sunday Training"":""7:00am–12:00pm & 2:00pm–5:00pm"",""Night Training"":""8:00pm–11:00pm""},""course_fees"":[{""category"":""Heavy Forklift"",""min_age"":20,""road_training"":""20 hours"",""total_hours"":24,""regular_course_fees"":{""hourly"":160,""total"":4450},""sunday_night_shift_fees"":{""hourly"":220,""total"":5650},""notes"":""All prices in AED, excluding VAT""}],""other_fees"":[{""type"":""Opening File (All Categories)"",""RTA"":200,""DDC"":540},{""type"":""Learning Permit (Light Vehicle)"",""RTA"":100,""DDC"":null},{""type"":""Learning Permit (Heavy Vehicle)"",""RTA"":200,""DDC"":null},{""type"":""Knowledge Handbook"",""RTA"":50,""DDC"":null},{""type"":""Knowledge Dirham"",""RTA"":10,""DDC"":null},{""type"":""Innovation Dirham"",""RTA"":10,""DDC"":null},{""type"":""Internal Test (Motorcycle/Heavy/Light Vehicle)"",""RTA"":220,""DDC"":70},{""type"":""Knowledge Test (All Categories)"",""RTA"":220,""DDC"":70},{""type"":""Final Test (All Categories)"",""RTA"":220,""DDC"":70},{""type"":""License Issuance (>1 Year)"",""RTA"":320,""DDC"":100},{""type"":""License Issuance (1 Year)"",""RTA"":120,""DDC"":100},{""type"":""Initial Driving Assessment Test (All Categories)"",""RTA"":null,""DDC"":100}]}"`;

function parseCSVRow(row: string): DetailRow | null {
  const values: string[] = [];
  let currentValue = '';
  let insideQuotes = false;

  for (let i = 0; i < row.length; i++) {
    const char = row[i];
    const nextChar = row[i + 1];

    if (char === '"' && nextChar === '"' && insideQuotes) {
      currentValue += '"';
      i++;
    } else if (char === '"') {
      insideQuotes = !insideQuotes;
    } else if (char === ',' && !insideQuotes) {
      values.push(currentValue);
      currentValue = '';
    } else {
      currentValue += char;
    }
  }
  values.push(currentValue);

  if (values.length !== 6) {
    return null;
  }

  return {
    school_id: parseInt(values[0]),
    category_id: parseInt(values[1]),
    documents_required: values[2],
    course_details: values[3],
    lecture_details: values[4],
    fees: values[5]
  };
}

async function importSchool4Details() {
  console.log('Starting import of school 4 details...');

  const lines = csvData.trim().split('\n');
  const dataRows = lines.slice(1);

  const records = [];

  for (let i = 0; i < dataRows.length; i++) {
    const row = parseCSVRow(dataRows[i]);

    if (!row) {
      console.error(`Failed to parse row ${i + 1}`);
      continue;
    }

    try {
      const documentsRequired = JSON.parse(row.documents_required);
      const courseDetails = JSON.parse(row.course_details);
      const lectureDetails = JSON.parse(row.lecture_details);
      const fees = JSON.parse(row.fees);

      records.push({
        school_id: row.school_id,
        category_id: row.category_id,
        documents_required: documentsRequired,
        course_details: courseDetails,
        lecture_details: lectureDetails,
        fees: fees
      });

      console.log(`Parsed record for school ${row.school_id}, category ${row.category_id}`);
    } catch (error) {
      console.error(`Failed to parse JSON for row ${i + 1}:`, error);
    }
  }

  console.log(`\nParsed ${records.length} records. Starting database insertion...`);

  for (const record of records) {
    const { data, error } = await supabase
      .from('details')
      .upsert(record, {
        onConflict: 'school_id,category_id'
      })
      .select();

    if (error) {
      console.error(`Error inserting record for category ${record.category_id}:`, error);
    } else {
      console.log(`Successfully inserted/updated record for category ${record.category_id}`);
    }
  }

  console.log('\nVerifying insertion...');
  const { data: verifyData, error: verifyError } = await supabase
    .from('details')
    .select('*')
    .eq('school_id', 4);

  if (verifyError) {
    console.error('Error verifying data:', verifyError);
  } else {
    console.log(`\nVerification complete: Found ${verifyData?.length || 0} records for school 4`);
    console.log('Category IDs:', verifyData?.map(d => d.category_id).sort());
  }
}

importSchool4Details().catch(console.error);
